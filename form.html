<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Order Form</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="bootstrap.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
	<!--script defer src="https://pyscript.net/latest/pyscript.js"></script-->
</head>
<body>
	<nav class="navbar navbar-expand-md navbar-dark bg-dark" aria-label="Al Hasanah Stationaries">
		<div class="container-fluid">
		  <a class="navbar-brand" href="index.html">Al Hasanah Stationaries</a>
		  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		  </button>
	
		  <div class="collapse navbar-collapse">
			<ul class="navbar-nav me-auto mb-2 mb-md-0">
			  <li class="nav-item">
				<a class="nav-link btn btn-outline-success" href="index.html">Home</a>
			  </li>
			  <li class="nav-item">
				<a class="nav-link btn btn-outline-success" href="form.html">Order</a>
			  </li>
			  <li class="nav-item">
				<a class="nav-link btn btn-outline-success" href="faq.html">FAQ</a>
			  </li>
			  <li class="nav-item">
				<a class="nav-link btn btn-outline-success" href="./index.html#contacts">Contact</a>
			  </li>
			</ul>
			<form role="search">
			  <input class="form-control" type="search" placeholder="Search" aria-label="Search">
			</form>
		  </div>
		</div>
	  </nav>
<!-- After the navbar -->
<div id="main">
	<h1>Order now!</h1>
	<form id="order-form">
	  <p>Name</p>
	  <input type="text" id="name" name="name" placeholder="Name" required>
	  <p>Class</p>
	  <input type="number" id="class" name="class" placeholder="Class" min="1" max="9" required>
	  <p>Product</p>
	  <select id="product" name="product" required>
		<option value="Matador High-School Pen">Matador High-School Pen</option>
		<option value="Fresh All-All-Rounder Pen">Fresh All-All-Rounder Pen</option>
		<option value="Matador i-teen Rio Pencil">Matador i-teen Rio Pencil</option>
		<option value="Matador i-teen Erasers">Matador i-teen Erasers</option>
		<option value="Matador i-teen Sharpners (Small)">Matador i-teen Sharpners (Small)</option>
		<option value="Exercise Book (Grade A)">Exercise Book (Grade A)</option>
		<option value="Exercise Book (Grade B)">Exercise Book (Grade B)</option>
	  </select>
	  <p>Amount</p>
	  <input type="number" id="amount" name="amount" placeholder="1~24" min="1" max="24" required>
	  <p>Address</p>
	  <input type="text" id="address" name="address" placeholder="Address" required>
	  <p>Where do you want to receive your product?</p>
	  <select id="delivery" name="delivery" required>
		<option value="school">School</option>
		<option value="delivery">Home Delivery</option>
	  </select>
	  <input type="submit" id="submit" value="Submit">
	  <p id="error-message" style="color: red;"></p>
	</form>
  </div>
	<script type="module">
		import { BREVO_API_KEY } from '../env.js';
		const form = document.getElementById('order-form');
		const submitButton = document.getElementById('submit');
		const errorMessage = document.getElementById('error-message');

		form.addEventListener('submit', (e) => {
		e.preventDefault();
		const formData = new FormData(form);
		const name = formData.get('name');
		const classValue = formData.get('class');
		const product = formData.get('product');
		const amount = formData.get('amount');
		const address = formData.get('address');
		const delivery = formData.get('delivery');

		// Error handling
		if (name.trim() === '') {
			errorMessage.textContent = 'Please enter your name';
			return;
		}
		if (classValue < 1 || classValue > 9) {
			errorMessage.textContent = 'Please enter a valid class';
			return;
		}
		if (amount < 1 || amount > 24) {
			errorMessage.textContent = 'Please enter a valid amount';
			return;
		}
		if (address.trim() === '') {
			errorMessage.textContent = 'Please enter your address';
			return;
		}

		// Send email using Brevo SMTP server
		fetch('https://api.sendinblue.com/v3/smtp/email', {
			method: 'POST',
			headers: {
			'Content-Type': 'application/json',
			'api-key': BREVO_API_KEY
			},
			body: JSON.stringify({
			'sender': {
				'name': 'Your Name',
				'email': 'a.binsharif1@gmail.com'
			},
			'to': [
				{
				'email': 'a.binsharif1@gmail.com',
				'name': 'Anas Bin Sharif'
				}
			],
			'subject': 'New Order',
			'htmlContent': `Name: ${name}<br>Class: ${classValue}<br>Product: ${product}<br>Amount: ${amount}<br>Address: ${address}<br>Delivery: ${delivery}`
			})
		})
		.then((response) => {
			if (response.ok) {
			alert('Email sent successfully!');
			form.reset();
			errorMessage.textContent = '';
			} else {
			errorMessage.textContent = 'Error sending email';
			}
		})
		.catch((error) => {
			console.error(error);
		});
		});
	</script>
</body>
</html>